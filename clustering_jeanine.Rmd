---
title: "462-project"
output: html_document
---

```{r}
# libraries
library(protoclust)
library(tidyverse)
library(MASS)
library(rgl)

# 

cbPalette <- c("#999999", "#E69F00", "#56B4E9", "#009E73", "#F0E442",
               "#0072B2", "#D55E00", "#CC79A7", "#551A8B", "brown", "blue")

# departing flight data
dep2015 <- read.csv("dep2015_expanded.csv")
dep2016_visible <- read.csv("dep2016_visible.csv")
flight2016_guess <- read.csv("flights2016_guess.csv")

source("remove_columns.R")

# removing columns that give info about delays
dep2015 <- remove.columns(dep2015)
dep2016_visible <- remove.columns(dep2016_visible)
dep2015$DEP_DEL15 <- as.factor(dep2015$DEP_DEL15)

# subset of the continuous values of departing flight data
dep2015_cont <- dplyr::select(dep2015, CRS_DEP_TIME, CRS_ARR_TIME, CRS_ELAPSED_TIME, DISTANCE)

# center & scale
dep2015_cont_scale <- scale(dep2015_cont)

#####################    UNSUPERVISED CLUSTERING   #################################
##   PCA   ##
# High collinearity in the data, so use PCA to reduce dimensions a bit.
pca_dep2015 <- princomp(dep2015_cont, cor = TRUE)

# how is the variance spread out over dimensuons
plot(pca_dep2015$sdev^2/sum(pca_dep2015$sdev^2))

plot(cumsum(pca_dep2015$sdev^2)/sum(pca_dep2015$sdev^2), main='Cumulative proportion of variance explained', xlab='Number of components',ylab='Proportion of variance explained')

# the first 2 components explain about 94%?
comp <- data.frame(pca_dep2015$scores[, 1:2])

# Determine number of clusters
wss <- (nrow(comp)-1)*sum(apply(comp,2,var))
for (i in 2:15) wss[i] <- sum(kmeans(comp,
                                     centers=i)$withinss)
plot(1:15, wss, type="b", xlab="Number of Clusters",
     ylab="Within groups sum of squares")

#######################  K MEANS   ##################################################
k_means <- kmeans(comp, centers = 10, nstart = 25, iter.max = 1000, algorithm = "Lloyd")

# look at the clusters
plot(comp$Comp.1, comp$Comp.2, col = cbPalette[k_means$cluster], pch = as.character(dep2015$DEP_DEL15),
     ylab = "Second Component", xlab = "First Component")
points(k_means$centers, col = "red", pch = 16)

# misclassification
table(k_means$cluster, dep2015$DEP_DEL15)
```

